<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Taylor|Here</title>
  <meta name="author" content="Taylor Lee">
  
  <meta name="description" content="Taylor&#39;s blog|python|android|java|js|">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="Taylor|Here"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Taylor|Here" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  

</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">Taylor|Here</a></h1>
  <h2><a href="/">seize the day</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">
  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-12-24T07:52:11.000Z"><a href="/2016/12/24/deploying/">2016-12-24</a></time>
      
      
  
    <h1 class="title"><a href="/2016/12/24/deploying/"></a></h1>
  

    </header>
    <div class="entry">
      
        <h1 id="Deploying"><a href="#Deploying" class="headerlink" title="Deploying"></a>Deploying</h1><p>When it comes to deploying Sanic, there’s not much to it, but there are<br>a few things to take note of.</p>
<h2 id="Workers"><a href="#Workers" class="headerlink" title="Workers"></a>Workers</h2><p>By default, Sanic listens in the main process using only 1 CPU core.<br>To crank up the juice, just specify the number of workers in the run<br>arguments like so:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">app.run(host=<span class="string">'0.0.0.0'</span>, port=<span class="number">1337</span>, workers=<span class="number">4</span>)</div></pre></td></tr></table></figure>
<p>Sanic will automatically spin up multiple processes and route<br>traffic between them.  We recommend as many workers as you have<br>available cores.</p>
<h2 id="Running-via-Command"><a href="#Running-via-Command" class="headerlink" title="Running via Command"></a>Running via Command</h2><p>If you like using command line arguments, you can launch a sanic server<br>by executing the module.  For example, if you initialized sanic as<br>app in a file named server.py, you could run the server like so:</p>
<p><code>python -m sanic server.app --host=0.0.0.0 --port=1337 --workers=4</code></p>
<p>With this way of running sanic, it is not necessary to run app.run in<br>your python file.  If you do, just make sure you wrap it in name == main<br>like so:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    app.run(host=<span class="string">'0.0.0.0'</span>, port=<span class="number">1337</span>, workers=<span class="number">4</span>)</div></pre></td></tr></table></figure>
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-12-24T07:52:11.000Z"><a href="/2016/12/24/routing/">2016-12-24</a></time>
      
      
  
    <h1 class="title"><a href="/2016/12/24/routing/"></a></h1>
  

    </header>
    <div class="entry">
      
        <h1 id="Routing"><a href="#Routing" class="headerlink" title="Routing"></a>Routing</h1><p>Sanic comes with a basic router that supports request parameters.  To specify a parameter, surround it with carrots like so: <code>&lt;PARAM&gt;</code>.  Request parameters will be passed to the request handler functions as keyword arguments.  To specify a type, add a :type after the parameter name, in the carrots.  If the parameter does not match the type supplied, Sanic will throw a NotFound exception, resulting in a 404 page not found error.</p>
<h2 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> sanic <span class="keyword">import</span> Sanic</div><div class="line"><span class="keyword">from</span> sanic.response <span class="keyword">import</span> text</div><div class="line"></div><div class="line"><span class="meta">@app.route('/tag/&lt;tag&gt;')</span></div><div class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">tag_handler</span><span class="params">(request, tag)</span>:</span></div><div class="line">	<span class="keyword">return</span> text(<span class="string">'Tag - &#123;&#125;'</span>.format(tag))</div><div class="line"></div><div class="line"><span class="meta">@app.route('/number/&lt;integer_arg:int&gt;')</span></div><div class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">integer_handler</span><span class="params">(request, integer_arg)</span>:</span></div><div class="line">	<span class="keyword">return</span> text(<span class="string">'Integer - &#123;&#125;'</span>.format(integer_arg))</div><div class="line"></div><div class="line"><span class="meta">@app.route('/number/&lt;number_arg:number&gt;')</span></div><div class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">number_handler</span><span class="params">(request, number_arg)</span>:</span></div><div class="line">	<span class="keyword">return</span> text(<span class="string">'Number - &#123;&#125;'</span>.format(number_arg))</div><div class="line"></div><div class="line"><span class="meta">@app.route('/person/&lt;name:[A-z]&gt;')</span></div><div class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">person_handler</span><span class="params">(request, name)</span>:</span></div><div class="line">	<span class="keyword">return</span> text(<span class="string">'Person - &#123;&#125;'</span>.format(name))</div><div class="line"></div><div class="line"><span class="meta">@app.route('/folder/&lt;folder_id:[A-z0-9]&#123;0,4&#125;&gt;')</span></div><div class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">folder_handler</span><span class="params">(request, folder_id)</span>:</span></div><div class="line">	<span class="keyword">return</span> text(<span class="string">'Folder - &#123;&#125;'</span>.format(folder_id))</div><div class="line"></div><div class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">handler1</span><span class="params">(request)</span>:</span></div><div class="line">	<span class="keyword">return</span> text(<span class="string">'OK'</span>)</div><div class="line">app.add_route(handler1, <span class="string">'/test'</span>)</div><div class="line"></div><div class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">handler</span><span class="params">(request, name)</span>:</span></div><div class="line">	<span class="keyword">return</span> text(<span class="string">'Folder - &#123;&#125;'</span>.format(name))</div><div class="line">app.add_route(handler, <span class="string">'/folder/&lt;name&gt;'</span>)</div><div class="line"></div><div class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">person_handler</span><span class="params">(request, name)</span>:</span></div><div class="line">	<span class="keyword">return</span> text(<span class="string">'Person - &#123;&#125;'</span>.format(name))</div><div class="line">app.add_route(handler, <span class="string">'/person/&lt;name:[A-z]&gt;'</span>)</div></pre></td></tr></table></figure>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-12-24T07:52:11.000Z"><a href="/2016/12/24/request_data/">2016-12-24</a></time>
      
      
  
    <h1 class="title"><a href="/2016/12/24/request_data/"></a></h1>
  

    </header>
    <div class="entry">
      
        <h1 id="Request-Data"><a href="#Request-Data" class="headerlink" title="Request Data"></a>Request Data</h1><h2 id="Properties"><a href="#Properties" class="headerlink" title="Properties"></a>Properties</h2><p>The following request variables are accessible as properties:</p>
<p><code>request.files</code> (dictionary of File objects) - List of files that have a name, body, and type<br><code>request.json</code> (any) - JSON body<br><code>request.args</code> (dict) - Query String variables.  Use getlist to get multiple of the same name<br><code>request.form</code> (dict) - Posted form variables.  Use getlist to get multiple of the same name<br><code>request.body</code> (bytes) - Posted raw body.  To get the raw data, regardless of content type  </p>
<p>See request.py for more information</p>
<h2 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> sanic <span class="keyword">import</span> Sanic</div><div class="line"><span class="keyword">from</span> sanic.response <span class="keyword">import</span> json, text</div><div class="line"></div><div class="line"><span class="meta">@app.route("/json")</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">post_json</span><span class="params">(request)</span>:</span></div><div class="line">    <span class="keyword">return</span> json(&#123; <span class="string">"received"</span>: <span class="keyword">True</span>, <span class="string">"message"</span>: request.json &#125;)</div><div class="line"></div><div class="line"><span class="meta">@app.route("/form")</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">post_json</span><span class="params">(request)</span>:</span></div><div class="line">    <span class="keyword">return</span> json(&#123; <span class="string">"received"</span>: <span class="keyword">True</span>, <span class="string">"form_data"</span>: request.form, <span class="string">"test"</span>: request.form.get(<span class="string">'test'</span>) &#125;)</div><div class="line"></div><div class="line"><span class="meta">@app.route("/files")</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">post_json</span><span class="params">(request)</span>:</span></div><div class="line">	test_file = request.files.get(<span class="string">'test'</span>)</div><div class="line"></div><div class="line">	file_parameters = &#123;</div><div class="line">		<span class="string">'body'</span>: test_file.body,</div><div class="line">		<span class="string">'name'</span>: test_file.name,</div><div class="line">		<span class="string">'type'</span>: test_file.type,</div><div class="line">	&#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> json(&#123; <span class="string">"received"</span>: <span class="keyword">True</span>, <span class="string">"file_names"</span>: request.files.keys(), <span class="string">"test_file_parameters"</span>: file_parameters &#125;)</div><div class="line"></div><div class="line"><span class="meta">@app.route("/query_string")</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">query_string</span><span class="params">(request)</span>:</span></div><div class="line">    <span class="keyword">return</span> json(&#123; <span class="string">"parsed"</span>: <span class="keyword">True</span>, <span class="string">"args"</span>: request.args, <span class="string">"url"</span>: request.url, <span class="string">"query_string"</span>: request.query_string &#125;)</div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">@app.route("/users", methods=["POST",])</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_user</span><span class="params">(request)</span>:</span></div><div class="line">    <span class="keyword">return</span> text(<span class="string">"You are trying to create a user with the following POST: %s"</span> % request.body)</div></pre></td></tr></table></figure>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-12-24T07:52:11.000Z"><a href="/2016/12/24/testing/">2016-12-24</a></time>
      
      
  
    <h1 class="title"><a href="/2016/12/24/testing/"></a></h1>
  

    </header>
    <div class="entry">
      
        <h1 id="Testing"><a href="#Testing" class="headerlink" title="Testing"></a>Testing</h1><p>Sanic endpoints can be tested locally using the <code>sanic.utils</code> module, which<br>depends on the additional <a href="https://aiohttp.readthedocs.io/en/stable/" target="_blank" rel="external">aiohttp</a><br>library. The <code>sanic_endpoint_test</code> function runs a local server, issues a<br>configurable request to an endpoint, and returns the result. It takes the<br>following arguments:</p>
<ul>
<li><code>app</code> An instance of a Sanic app.</li>
<li><code>method</code> <em>(default <code>&#39;get&#39;</code>)</em> A string representing the HTTP method to use.</li>
<li><code>uri</code> <em>(default <code>&#39;/&#39;</code>)</em> A string representing the endpoint to test.</li>
<li><code>gather_request</code> <em>(default <code>True</code>)</em> A boolean which determines whether the<br>original request will be returned by the function. If set to <code>True</code>, the<br>return value is a tuple of <code>(request, response)</code>, if <code>False</code> only the<br>response is returned.</li>
<li><code>loop</code> <em>(default <code>None</code>)</em> The event loop to use.</li>
<li><code>debug</code> <em>(default <code>False</code>)</em> A boolean which determines whether to run the<br>server in debug mode.</li>
</ul>
<p>The function further takes the <code>*request_args</code> and <code>**request_kwargs</code>, which<br>are passed directly to the aiohttp ClientSession request. For example, to<br>supply data with a GET request, <code>method</code> would be <code>get</code> and the keyword<br>argument <code>params={&#39;value&#39;, &#39;key&#39;}</code> would be supplied. More information about<br>the available arguments to aiohttp can be found<br><a href="https://aiohttp.readthedocs.io/en/stable/client_reference.html#client-session" target="_blank" rel="external">in the documentation for ClientSession</a>.</p>
<p>Below is a complete example of an endpoint test,<br>using <a href="http://doc.pytest.org/en/latest/" target="_blank" rel="external">pytest</a>. The test checks that the<br><code>/challenge</code> endpoint responds to a GET request with a supplied challenge<br>string.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> pytest</div><div class="line"><span class="keyword">import</span> aiohttp</div><div class="line"><span class="keyword">from</span> sanic.utils <span class="keyword">import</span> sanic_endpoint_test</div><div class="line"></div><div class="line"><span class="comment"># Import the Sanic app, usually created with Sanic(__name__)</span></div><div class="line"><span class="keyword">from</span> external_server <span class="keyword">import</span> app</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_endpoint_challenge</span><span class="params">()</span>:</span></div><div class="line">    <span class="comment"># Create the challenge data</span></div><div class="line">    request_data = &#123;<span class="string">'challenge'</span>: <span class="string">'dummy_challenge'</span>&#125;</div><div class="line"></div><div class="line">    <span class="comment"># Send the request to the endpoint, using the default `get` method</span></div><div class="line">    request, response = sanic_endpoint_test(app,</div><div class="line">                                            uri=<span class="string">'/challenge'</span>,</div><div class="line">                                            params=request_data)</div><div class="line"></div><div class="line">    <span class="comment"># Assert that the server responds with the challenge string</span></div><div class="line">    <span class="keyword">assert</span> response.text == request_data[<span class="string">'challenge'</span>]</div></pre></td></tr></table></figure>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-12-24T07:52:11.000Z"><a href="/2016/12/24/static_files/">2016-12-24</a></time>
      
      
  
    <h1 class="title"><a href="/2016/12/24/static_files/"></a></h1>
  

    </header>
    <div class="entry">
      
        <h1 id="Static-Files"><a href="#Static-Files" class="headerlink" title="Static Files"></a>Static Files</h1><p>Both directories and files can be served by registering with static</p>
<h2 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">app = Sanic(__name__)</div><div class="line"></div><div class="line"><span class="comment"># Serves files from the static folder to the URL /static</span></div><div class="line">app.static(<span class="string">'/static'</span>, <span class="string">'./static'</span>)</div><div class="line"></div><div class="line"><span class="comment"># Serves the file /home/ubuntu/test.png when the URL /the_best.png</span></div><div class="line"><span class="comment"># is requested</span></div><div class="line">app.static(<span class="string">'/the_best.png'</span>, <span class="string">'/home/ubuntu/test.png'</span>)</div><div class="line"></div><div class="line">app.run(host=<span class="string">"0.0.0.0"</span>, port=<span class="number">8000</span>)</div></pre></td></tr></table></figure>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-12-24T07:52:11.000Z"><a href="/2016/12/24/getting_started/">2016-12-24</a></time>
      
      
  
    <h1 class="title"><a href="/2016/12/24/getting_started/"></a></h1>
  

    </header>
    <div class="entry">
      
        <h1 id="Getting-Started"><a href="#Getting-Started" class="headerlink" title="Getting Started"></a>Getting Started</h1><p>Make sure you have pip and python 3.5 before starting</p>
<h2 id="Benchmarks"><a href="#Benchmarks" class="headerlink" title="Benchmarks"></a>Benchmarks</h2><ul>
<li>Install Sanic</li>
<li><code>python3 -m pip install sanic</code></li>
<li><p>Edit main.py to include:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> sanic <span class="keyword">import</span> Sanic</div><div class="line"><span class="keyword">from</span> sanic.response <span class="keyword">import</span> json</div><div class="line"></div><div class="line">app = Sanic(__name__)</div><div class="line"></div><div class="line"><span class="meta">@app.route("/")</span></div><div class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(request)</span>:</span></div><div class="line">    <span class="keyword">return</span> json(&#123; <span class="string">"hello"</span>: <span class="string">"world"</span> &#125;)</div><div class="line"></div><div class="line">app.run(host=<span class="string">"0.0.0.0"</span>, port=<span class="number">8000</span>, debug=<span class="keyword">True</span>)</div></pre></td></tr></table></figure>
</li>
<li><p>Run <code>python3 main.py</code></p>
</li>
</ul>
<p>You now have a working Sanic server!  To continue on, check out:</p>
<ul>
<li><a href="request_data.md">Request Data</a></li>
<li><a href="routing.md">Routing</a></li>
</ul>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-12-24T07:52:11.000Z"><a href="/2016/12/24/middleware/">2016-12-24</a></time>
      
      
  
    <h1 class="title"><a href="/2016/12/24/middleware/"></a></h1>
  

    </header>
    <div class="entry">
      
        <h1 id="Middleware"><a href="#Middleware" class="headerlink" title="Middleware"></a>Middleware</h1><p>Middleware can be executed before or after requests.  It is executed in the order it was registered.  If middleware returns a response object, the request will stop processing and a response will be returned.</p>
<p>Middleware is registered via the middleware decorator, and can either be added as ‘request’ or ‘response’ middleware, based on the argument provided in the decorator.  Response middleware receives both the request and the response as arguments.</p>
<h2 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">app = Sanic(__name__)</div><div class="line"></div><div class="line"><span class="meta">@app.middleware</span></div><div class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">halt_request</span><span class="params">(request)</span>:</span></div><div class="line">	print(<span class="string">"I am a spy"</span>)</div><div class="line"></div><div class="line"><span class="meta">@app.middleware('request')</span></div><div class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">halt_request</span><span class="params">(request)</span>:</span></div><div class="line">	<span class="keyword">return</span> text(<span class="string">'I halted the request'</span>)</div><div class="line"></div><div class="line"><span class="meta">@app.middleware('response')</span></div><div class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">halt_response</span><span class="params">(request, response)</span>:</span></div><div class="line">	<span class="keyword">return</span> text(<span class="string">'I halted the response'</span>)</div><div class="line"></div><div class="line"><span class="meta">@app.route('/')</span></div><div class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">handler</span><span class="params">(request)</span>:</span></div><div class="line">	<span class="keyword">return</span> text(<span class="string">'I would like to speak now please'</span>)</div><div class="line"></div><div class="line">app.run(host=<span class="string">"0.0.0.0"</span>, port=<span class="number">8000</span>)</div></pre></td></tr></table></figure>
<h2 id="Middleware-chain"><a href="#Middleware-chain" class="headerlink" title="Middleware chain"></a>Middleware chain</h2><p>If you want to apply the middleware as a chain, applying more than one, is so easy. You only have to be aware that you do <strong>not return</strong> any response in your middleware:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">app = Sanic(__name__)</div><div class="line"></div><div class="line"><span class="meta">@app.middleware('response')</span></div><div class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">custom_banner</span><span class="params">(request, response)</span>:</span></div><div class="line">	response.headers[<span class="string">"Server"</span>] = <span class="string">"Fake-Server"</span></div><div class="line"></div><div class="line"><span class="meta">@app.middleware('response')</span></div><div class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">prevent_xss</span><span class="params">(request, response)</span>:</span></div><div class="line">	response.headers[<span class="string">"x-xss-protection"</span>] = <span class="string">"1; mode=block"</span></div><div class="line"></div><div class="line">app.run(host=<span class="string">"0.0.0.0"</span>, port=<span class="number">8000</span>)</div></pre></td></tr></table></figure>
<p>The above code will apply the two middlewares in order. First the middleware <strong>custom_banner</strong> will change the HTTP Response headers <em>Server</em> by <em>Fake-Server</em>, and the second middleware <strong>prevent_xss</strong> will add the HTTP Headers for prevent Cross-Site-Scripting (XSS) attacks.</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-12-24T07:52:11.000Z"><a href="/2016/12/24/class_based_views/">2016-12-24</a></time>
      
      
  
    <h1 class="title"><a href="/2016/12/24/class_based_views/"></a></h1>
  

    </header>
    <div class="entry">
      
        <h1 id="Class-based-views"><a href="#Class-based-views" class="headerlink" title="Class based views"></a>Class based views</h1><p>Sanic has simple class based implementation. You should implement methods(get, post, put, patch, delete) for the class to every HTTP method you want to support. If someone tries to use a method that has not been implemented, there will be 405 response.</p>
<h2 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> sanic <span class="keyword">import</span> Sanic</div><div class="line"><span class="keyword">from</span> sanic.views <span class="keyword">import</span> HTTPMethodView</div><div class="line"><span class="keyword">from</span> sanic.response <span class="keyword">import</span> text</div><div class="line"></div><div class="line">app = Sanic(<span class="string">'some_name'</span>)</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">SimpleView</span><span class="params">(HTTPMethodView)</span>:</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request)</span>:</span></div><div class="line">      <span class="keyword">return</span> text(<span class="string">'I am get method'</span>)</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self, request)</span>:</span></div><div class="line">      <span class="keyword">return</span> text(<span class="string">'I am post method'</span>)</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">put</span><span class="params">(self, request)</span>:</span></div><div class="line">      <span class="keyword">return</span> text(<span class="string">'I am put method'</span>)</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">patch</span><span class="params">(self, request)</span>:</span></div><div class="line">      <span class="keyword">return</span> text(<span class="string">'I am patch method'</span>)</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(self, request)</span>:</span></div><div class="line">      <span class="keyword">return</span> text(<span class="string">'I am delete method'</span>)</div><div class="line"></div><div class="line">app.add_route(SimpleView(), <span class="string">'/'</span>)</div></pre></td></tr></table></figure>
<p>If you need any url params just mention them in method definition:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">NameView</span><span class="params">(HTTPMethodView)</span>:</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request, name)</span>:</span></div><div class="line">    <span class="keyword">return</span> text(<span class="string">'Hello &#123;&#125;'</span>.format(name))</div><div class="line"></div><div class="line">app.add_route(NameView(), <span class="string">'/&lt;name&gt;'</span>)</div></pre></td></tr></table></figure>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-12-24T07:52:11.000Z"><a href="/2016/12/24/blueprints/">2016-12-24</a></time>
      
      
  
    <h1 class="title"><a href="/2016/12/24/blueprints/"></a></h1>
  

    </header>
    <div class="entry">
      
        <h1 id="Blueprints"><a href="#Blueprints" class="headerlink" title="Blueprints"></a>Blueprints</h1><p>Blueprints are objects that can be used for sub-routing within an application.<br>Instead of adding routes to the application object, blueprints define similar<br>methods for adding routes, which are then registered with the application in a<br>flexible and pluggable manner.</p>
<h2 id="Why"><a href="#Why" class="headerlink" title="Why?"></a>Why?</h2><p>Blueprints are especially useful for larger applications, where your application<br>logic can be broken down into several groups or areas of responsibility.</p>
<p>It is also useful for API versioning, where one blueprint may point at<br><code>/v1/&lt;routes&gt;</code>, and another pointing at <code>/v2/&lt;routes&gt;</code>.</p>
<h2 id="My-First-Blueprint"><a href="#My-First-Blueprint" class="headerlink" title="My First Blueprint"></a>My First Blueprint</h2><p>The following shows a very simple blueprint that registers a handler-function at<br>the root <code>/</code> of your application.</p>
<p>Suppose you save this file as <code>my_blueprint.py</code>, this can be imported in your<br>main application later.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> sanic.response <span class="keyword">import</span> json</div><div class="line"><span class="keyword">from</span> sanic <span class="keyword">import</span> Blueprint</div><div class="line"></div><div class="line">bp = Blueprint(<span class="string">'my_blueprint'</span>)</div><div class="line"></div><div class="line"><span class="meta">@bp.route('/')</span></div><div class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">bp_root</span><span class="params">(request)</span>:</span></div><div class="line">    <span class="keyword">return</span> json(&#123;<span class="string">'my'</span>: <span class="string">'blueprint'</span>&#125;)</div></pre></td></tr></table></figure>
<h2 id="Registering-Blueprints"><a href="#Registering-Blueprints" class="headerlink" title="Registering Blueprints"></a>Registering Blueprints</h2><p>Blueprints must be registered with the application.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> sanic <span class="keyword">import</span> Sanic</div><div class="line"><span class="keyword">from</span> my_blueprint <span class="keyword">import</span> bp</div><div class="line"></div><div class="line">app = Sanic(__name__)</div><div class="line">app.blueprint(bp)</div><div class="line"></div><div class="line">app.run(host=<span class="string">'0.0.0.0'</span>, port=<span class="number">8000</span>, debug=<span class="keyword">True</span>)</div></pre></td></tr></table></figure>
<p>This will add the blueprint to the application and register any routes defined<br>by that blueprint.<br>In this example, the registered routes in the <code>app.router</code> will look like:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[Route(handler=&lt;function bp_root at <span class="number">0x7f908382f9d8</span>&gt;, methods=<span class="keyword">None</span>, pattern=re.compile(<span class="string">'^/$'</span>), parameters=[])]</div></pre></td></tr></table></figure>
<h2 id="Middleware"><a href="#Middleware" class="headerlink" title="Middleware"></a>Middleware</h2><p>Using blueprints allows you to also register middleware globally.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@bp.middleware</span></div><div class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">halt_request</span><span class="params">(request)</span>:</span></div><div class="line">	print(<span class="string">"I am a spy"</span>)</div><div class="line"></div><div class="line"><span class="meta">@bp.middleware('request')</span></div><div class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">halt_request</span><span class="params">(request)</span>:</span></div><div class="line">	<span class="keyword">return</span> text(<span class="string">'I halted the request'</span>)</div><div class="line"></div><div class="line"><span class="meta">@bp.middleware('response')</span></div><div class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">halt_response</span><span class="params">(request, response)</span>:</span></div><div class="line">	<span class="keyword">return</span> text(<span class="string">'I halted the response'</span>)</div></pre></td></tr></table></figure>
<h2 id="Exceptions"><a href="#Exceptions" class="headerlink" title="Exceptions"></a>Exceptions</h2><p>Exceptions can also be applied exclusively to blueprints globally.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@bp.exception(NotFound)</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">ignore_404s</span><span class="params">(request, exception)</span>:</span></div><div class="line">	<span class="keyword">return</span> text(<span class="string">"Yep, I totally found the page: &#123;&#125;"</span>.format(request.url))</div><div class="line"></div><div class="line"><span class="comment">## Static files</span></div><div class="line">Static files can also be served globally, under the blueprint prefix.</div><div class="line"></div><div class="line">```python</div><div class="line">bp.static(<span class="string">'/folder/to/serve'</span>, <span class="string">'/web/path'</span>)</div></pre></td></tr></table></figure>
<h2 id="Start-and-Stop"><a href="#Start-and-Stop" class="headerlink" title="Start and Stop"></a>Start and Stop</h2><p>Blueprints and run functions during the start and stop process of the server.<br>If running in multiprocessor mode (more than 1 worker), these are triggered after the workers fork<br>Available events are:</p>
<ul>
<li>before_server_start - Executed before the server begins to accept connections</li>
<li>after_server_start - Executed after the server begins to accept connections</li>
<li>before_server_stop - Executed before the server stops accepting connections</li>
<li>after_server_stop - Executed after the server is stopped and all requests are complete</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">bp = Blueprint(<span class="string">'my_blueprint'</span>)</div><div class="line"></div><div class="line"><span class="meta">@bp.listen('before_server_start')</span></div><div class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">setup_connection</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">global</span> database</div><div class="line">    database = mysql.connect(host=<span class="string">'127.0.0.1'</span>...)</div><div class="line">    </div><div class="line"><span class="meta">@bp.listen('after_server_stop')</span></div><div class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">close_connection</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">await</span> database.close()</div></pre></td></tr></table></figure>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-12-24T07:52:11.000Z"><a href="/2016/12/24/exceptions/">2016-12-24</a></time>
      
      
  
    <h1 class="title"><a href="/2016/12/24/exceptions/"></a></h1>
  

    </header>
    <div class="entry">
      
        <h1 id="Exceptions"><a href="#Exceptions" class="headerlink" title="Exceptions"></a>Exceptions</h1><p>Exceptions can be thrown from within request handlers and will automatically be handled by Sanic.  Exceptions take a message as their first argument, and can also take a status_code to be passed back in the HTTP response.  Check sanic.exceptions for the full list of exceptions to throw.</p>
<h2 id="Throwing-an-exception"><a href="#Throwing-an-exception" class="headerlink" title="Throwing an exception"></a>Throwing an exception</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> sanic <span class="keyword">import</span> Sanic</div><div class="line"><span class="keyword">from</span> sanic.exceptions <span class="keyword">import</span> ServerError</div><div class="line"></div><div class="line"><span class="meta">@app.route('/killme')</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">i_am_ready_to_die</span><span class="params">(request)</span>:</span></div><div class="line">	<span class="keyword">raise</span> ServerError(<span class="string">"Something bad happened"</span>)</div></pre></td></tr></table></figure>
<h2 id="Handling-Exceptions"><a href="#Handling-Exceptions" class="headerlink" title="Handling Exceptions"></a>Handling Exceptions</h2><p>Just use the @exception decorator.  The decorator expects a list of exceptions to handle as arguments.  You can pass SanicException to catch them all!  The exception handler must expect a request and exception object as arguments.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> sanic <span class="keyword">import</span> Sanic</div><div class="line"><span class="keyword">from</span> sanic.response <span class="keyword">import</span> text</div><div class="line"><span class="keyword">from</span> sanic.exceptions <span class="keyword">import</span> NotFound</div><div class="line"></div><div class="line"><span class="meta">@app.exception(NotFound)</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">ignore_404s</span><span class="params">(request, exception)</span>:</span></div><div class="line">	<span class="keyword">return</span> text(<span class="string">"Yep, I totally found the page: &#123;&#125;"</span>.format(request.url))</div></pre></td></tr></table></figure>
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





<nav id="pagination">
  
  
    <a href="/page/2/" class="alignright next">Nächste Seite</a>
  
  <div class="clearfix"></div>
</nav></div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Suche">
    <input type="hidden" name="q" value="site:yoursite.com">
  </form>
</div>

  

  
</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2016 Taylor Lee
  
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>
